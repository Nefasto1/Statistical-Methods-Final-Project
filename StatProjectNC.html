<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nicola Cortinovis, Roberta Lamberti, Marta Lucas, Stefano Tumino">
<meta name="dcterms.date" content="2024-02-20">

<title>Final_Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="StatProjectNC_files/libs/clipboard/clipboard.min.js"></script>
<script src="StatProjectNC_files/libs/quarto-html/quarto.js"></script>
<script src="StatProjectNC_files/libs/quarto-html/popper.min.js"></script>
<script src="StatProjectNC_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="StatProjectNC_files/libs/quarto-html/anchor.min.js"></script>
<link href="StatProjectNC_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="StatProjectNC_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="StatProjectNC_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="StatProjectNC_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="StatProjectNC_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Final_Project</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nicola Cortinovis, Roberta Lamberti, Marta Lucas, Stefano Tumino </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2024-02-20</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="quarto-version" class="level1">
<h1>Quarto version</h1>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<section id="import-the-libraries" class="level2">
<h2 class="anchored" data-anchor-id="import-the-libraries">Import the libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)        <span class="co"># GAMs</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)     <span class="co"># data splitting</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)       <span class="co"># data wrangling</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)       <span class="co"># performing regression trees</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)  <span class="co"># plotting regression trees</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipred)       <span class="co"># bagging</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret) </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gbm)         <span class="co"># gradient boosting</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-analysis" class="level1">
<h1>Data analysis</h1>
<section id="dataset-loading" class="level2">
<h2 class="anchored" data-anchor-id="dataset-loading">Dataset loading</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"phones_data.csv"</span>, <span class="at">header=</span>T)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       X           brand_name         model_name             os           
 Min.   :   0.0   Length:1224        Length:1224        Length:1224       
 1st Qu.: 305.8   Class :character   Class :character   Class :character  
 Median : 611.5   Mode  :character   Mode  :character   Mode  :character  
 Mean   : 611.5                                                           
 3rd Qu.: 917.2                                                           
 Max.   :1223.0                                                           
                                                                          
   popularity       best_price     lowest_price   highest_price  
 Min.   :   1.0   Min.   :  214   Min.   :  198   Min.   :  229  
 1st Qu.: 306.8   1st Qu.: 2600   1st Qu.: 2399   1st Qu.: 2887  
 Median : 612.5   Median : 4728   Median : 4574   Median : 5326  
 Mean   : 612.5   Mean   : 7941   Mean   : 7716   Mean   : 9883  
 3rd Qu.: 918.2   3rd Qu.: 9323   3rd Qu.: 9262   3rd Qu.:12674  
 Max.   :1224.0   Max.   :56082   Max.   :49999   Max.   :69999  
                                  NA's   :260     NA's   :260    
 sellers_amount    screen_size     memory_size        battery_size  
 Min.   :  1.00   Min.   :1.400   Min.   :3.20e-03   Min.   :  460  
 1st Qu.:  2.00   1st Qu.:5.162   1st Qu.:3.20e+01   1st Qu.: 2900  
 Median :  8.00   Median :6.000   Median :6.40e+01   Median : 3687  
 Mean   : 16.74   Mean   :5.394   Mean   :9.57e+01   Mean   : 3608  
 3rd Qu.: 26.00   3rd Qu.:6.400   3rd Qu.:1.28e+02   3rd Qu.: 4400  
 Max.   :125.00   Max.   :8.100   Max.   :1.00e+03   Max.   :18800  
                  NA's   :2       NA's   :112        NA's   :10     
 release_date      
 Length:1224       
 Class :character  
 Mode  :character  
                   
                   
                   
                   </code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 62%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>Variables</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>brand_name</td>
<td>Name of the phone brand</td>
<td>chr</td>
</tr>
<tr class="even">
<td>model_name</td>
<td>Name of the phone model</td>
<td>chr</td>
</tr>
<tr class="odd">
<td>os</td>
<td>Operating system</td>
<td>chr</td>
</tr>
<tr class="even">
<td>Popularity</td>
<td>The popularity of the phone in range 1-1224</td>
<td>int</td>
</tr>
<tr class="odd">
<td>Best Price</td>
<td>Best price of the price-range in (UAH)</td>
<td>num</td>
</tr>
<tr class="even">
<td>Lowest Price</td>
<td>Highest price of the price-range in (UAH)</td>
<td>num</td>
</tr>
<tr class="odd">
<td>highest_price</td>
<td>Lowest price of the price-range in (UAH)</td>
<td>num</td>
</tr>
<tr class="even">
<td>Sellers amount</td>
<td>The amount sellers sold the phone</td>
<td>num</td>
</tr>
<tr class="odd">
<td>Screen size</td>
<td>The size of phone’s screen (inches).</td>
<td>num</td>
</tr>
<tr class="even">
<td>Memory size</td>
<td>The size of the phone’s memory (GB)</td>
<td>num</td>
</tr>
<tr class="odd">
<td>Battery size</td>
<td>The size of the phone’s battery (mAh)</td>
<td>num</td>
</tr>
<tr class="even">
<td>Release date</td>
<td>The launch date of the product on the market</td>
<td>chr</td>
</tr>
</tbody>
</table>
</section>
<section id="dataset-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="dataset-cleaning">Dataset cleaning</h2>
<section id="removing-the-index-column" class="level3">
<h3 class="anchored" data-anchor-id="removing-the-index-column">Removing the index column</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>X <span class="ot">=</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="factorizing-the-categorical-variables" class="level3">
<h3 class="anchored" data-anchor-id="factorizing-the-categorical-variables">Factorizing the categorical variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>brand_name <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>brand_name)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>os <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>os)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="managing-missing-variables" class="level3">
<h3 class="anchored" data-anchor-id="managing-missing-variables">Managing missing variables</h3>
<section id="battery_size-and-screen_size-handling" class="level4">
<h4 class="anchored" data-anchor-id="battery_size-and-screen_size-handling">Battery_size and screen_size handling</h4>
<p>We decided to drop the rows having missing variables for <code>battery_size</code> and <code>screen_size</code> since they were in low number.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="sc">-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>battery_size)),]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="sc">-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>screen_size)),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the rows having missing values for <code>highest_price</code> and <code>lowest_price</code> we substitued them with a value that is resistant to outliers, namely the median. #### Highest/Lowest_price handling</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>lowest_price))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>lowest_price[tmp] <span class="ot">&lt;-</span> <span class="fu">median</span>(df<span class="sc">$</span>lowest_price[<span class="sc">-</span>tmp])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>highest_price))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>highest_price[tmp] <span class="ot">&lt;-</span> <span class="fu">median</span>(df<span class="sc">$</span>highest_price[<span class="sc">-</span>tmp])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="memory_size-handling" class="level4">
<h4 class="anchored" data-anchor-id="memory_size-handling">Memory_size handling</h4>
<p>We noticed that the only rows having <code>NA</code> in the <code>memory_size</code> feature were those with <code>os == ""</code>. Further investigation shows that this <code>blank</code> os refers to very simple phones that are usually given to elderly people. We decided to label them as <code>other</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace empty strings in df$os with "other"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>os <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^$"</span>, <span class="st">"other"</span>, df<span class="sc">$</span>os)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>os <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>os)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df[df<span class="sc">$</span>os <span class="sc">==</span> <span class="st">"other"</span>, <span class="st">"memory_size"</span> ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
 0.0032  0.0320  0.0320  0.9702  0.0320 64.0000     111 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the standardized 'memory_size' column</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>memory_size_other <span class="ot">&lt;-</span> df[df<span class="sc">$</span>os <span class="sc">==</span> <span class="st">"other"</span>, <span class="st">"memory_size"</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the indices of the top 5 values</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>top5_indices <span class="ot">&lt;-</span> <span class="fu">order</span>(memory_size_other, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a color vector</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"black"</span>, <span class="fu">length</span>(memory_size_other))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>colors[top5_indices] <span class="ot">&lt;-</span> <span class="st">"red"</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the 'memory_size' column for 'other' OS with the top 5 values colored red</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(memory_size_other, <span class="at">main =</span> <span class="st">"Memory Size for 'other' OS"</span>, <span class="at">ylab =</span> <span class="st">"Memory Size"</span>, <span class="at">col =</span> colors, <span class="at">type =</span> <span class="st">"p"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Given the presence of such big outliers, we decided to substitute the NA with the median of the data having “other” as the <code>os</code> feature.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> df[<span class="fu">which</span>(df<span class="sc">$</span>os <span class="sc">==</span> <span class="st">"other"</span>),]<span class="sc">$</span>memory_size</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>memory_size[<span class="fu">which</span>(<span class="fu">is.na</span>(df<span class="sc">$</span>memory_size))] <span class="ot">&lt;-</span> <span class="fu">median</span>(tmp[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">is.na</span>(tmp))])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="converting-prices" class="level3">
<h3 class="anchored" data-anchor-id="converting-prices">Converting prices</h3>
<section id="aux-function-for-conversion" class="level4">
<h4 class="anchored" data-anchor-id="aux-function-for-conversion">Aux function for € conversion</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to convert currency A to Euros</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>convert_to_euros <span class="ot">&lt;-</span> <span class="cf">function</span>(value, <span class="at">conversion_rate =</span> <span class="fl">0.024</span>) {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the value in Euros</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(value <span class="sc">*</span> conversion_rate)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conversion" class="level4">
<h4 class="anchored" data-anchor-id="conversion">Conversion</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>best_price <span class="ot">&lt;-</span> <span class="fu">convert_to_euros</span>(df<span class="sc">$</span>best_price)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>lowest_price <span class="ot">&lt;-</span> <span class="fu">convert_to_euros</span>(df<span class="sc">$</span>lowest_price)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>highest_price <span class="ot">&lt;-</span> <span class="fu">convert_to_euros</span>(df<span class="sc">$</span>highest_price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="improving-readibility-of-the-os-variable" class="level3">
<h3 class="anchored" data-anchor-id="improving-readibility-of-the-os-variable">Improving readibility of the os variable</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>os)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Android         EMUI          iOS        KAIOS        other     OxygenOS 
         910            2           97            1          196            3 
WindowsPhone 
           3 </code></pre>
</div>
</div>
<p>We notice that, for the <code>os</code> feature, <strong>2</strong> are <strong>EMUI</strong>, <strong>1</strong> is <strong>KAIOS</strong>, <strong>3</strong> are <strong>OxygenOS</strong> and <strong>3</strong> are <strong>WindowsPhone</strong>. We decided to lable them either <strong>Android</strong> or <strong>other</strong> based on which class theyr features were closer to.</p>
<section id="labeling-of-the-other-oss" class="level4">
<h4 class="anchored" data-anchor-id="labeling-of-the-other-oss">Labeling of the other OSs</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate the mean of all numeric columns for each value of df$os</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>calculate_means <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Split the data frame by the 'os' column</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  split_df <span class="ot">&lt;-</span> <span class="fu">split</span>(df, df<span class="sc">$</span>os)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Function to calculate the mean of each column</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  mean_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.numeric</span>(x)) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply the function to each subset of the data frame</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  mean_df <span class="ot">&lt;-</span> <span class="fu">lapply</span>(split_df, <span class="cf">function</span>(x) <span class="fu">sapply</span>(x, mean_fun))</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove NULL elements (non-numeric columns)</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  mean_df <span class="ot">&lt;-</span> <span class="fu">lapply</span>(mean_df, <span class="cf">function</span>(x) x[<span class="sc">!</span><span class="fu">sapply</span>(x, is.null)])</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert the list back to a data frame</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  mean_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, mean_df)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mean_df)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="fu">calculate_means</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             popularity best_price lowest_price highest_price sellers_amount
Android      629.967    191.369    168.8557     205.6044      13.01648      
EMUI         412        759.744    743.544      794.136       10            
iOS          865.9691   508.7693   434.6948     621.6396      42.49485      
KAIOS        832        24.864     21.576       25.416        42            
other        410.6276   18.16947   27.96331     34.21592      21.0051       
OxygenOS     448        158.704    144.16       200.776       9.333333      
WindowsPhone 197        62.4       108.468      127.176       1             
             screen_size memory_size battery_size
Android      6.045209    96.43956    4137.695    
EMUI         6.58        512         4200        
iOS          5.561856    161.1134    2683.557    
KAIOS        2.4         4           2000        
other        2.314949    0.4388653   1647.194    
OxygenOS     5.5         106.6667    3400        
WindowsPhone 4.5         16          2000        </code></pre>
</div>
</div>
<p>From these results we decided to relable them in this way: - <strong>EMUI</strong> -&gt; <strong>Android</strong> - <strong>KAIOS</strong> -&gt; <strong>other</strong> - <strong>OxygenOS</strong> -&gt; <strong>Android</strong> - <strong>WindowsPhone</strong> -&gt; <strong>Android</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode the 'os' column</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(df<span class="sc">$</span>os) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"other"</span>, <span class="st">"Android"</span>, <span class="st">"Android"</span>, <span class="st">"iOS"</span>, <span class="st">"other"</span>, <span class="st">"Android"</span>, <span class="st">"Android"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="handling-outlier" class="level3">
<h3 class="anchored" data-anchor-id="handling-outlier">Handling outlier</h3>
<p>From our previous data exploration there was one phone having <code>os == "other"</code> with a relatively big value for its <code>memory_size</code> feature. We decided to lable it as <strong>Android</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>os <span class="sc">==</span> <span class="st">"other"</span>, ][<span class="fu">which.max</span>(df<span class="sc">$</span>memory_size[df<span class="sc">$</span>os <span class="sc">==</span> <span class="st">"other"</span>]),]<span class="sc">$</span>os <span class="ot">=</span> <span class="st">"Android"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="splitting-the-timestamp" class="level3">
<h3 class="anchored" data-anchor-id="splitting-the-timestamp">Splitting the timestamp</h3>
<p>To better explore the relationship between <code>best_price</code> and <code>release_date</code> we decided to split the latter variable in two features: <code>month</code> and <code>year</code>. For simpler reading we subtracted 2000 to the years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(df<span class="sc">$</span>release_date, <span class="at">FUN =</span> <span class="cf">function</span>(x) {<span class="fu">strsplit</span>(x, <span class="at">split =</span> <span class="st">'[-]'</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]}))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(df<span class="sc">$</span>release_date, <span class="at">FUN =</span> <span class="cf">function</span>(x) {<span class="fu">strsplit</span>(x, <span class="at">split =</span> <span class="st">'[-]'</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>]}))<span class="sc">-</span><span class="dv">2000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checking-for-duplicates" class="level3">
<h3 class="anchored" data-anchor-id="checking-for-duplicates">Checking for duplicates</h3>
<p>We first check for duplicates inside the data, not considering the features <code>popularity</code> and <code>model_name</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>idxs <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">duplicated</span>(df[,<span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">4</span>)]))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df[idxs[<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>],]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   brand_name                                   model_name    os popularity
3     ALCATEL 1 5033D 1/16GB Volcano Black (5033D-2LALUAF) other        299
4     ALCATEL 1 5033D 1/16GB Volcano Black (5033D-2LALUAF) other        287
11      Honor                         10 lite 3/64GB Black other        179
15      Nokia        105 Dual Sim 2019 Black (16KIGB01A01) other        274
20      Nokia         105 Single Sim New Black (A00028356) other        455
24      Nokia                106 New DS Grey (16NEBD01A02) other        841
26      Honor                  10i 4/128GB Blue (51093VQX) other        444
32      Meizu                              15 4/64GB Black other        125
33      Meizu                              15 4/64GB Black other        116
35      Meizu                          15 Plus 6/64GB Gray other        415
   best_price lowest_price highest_price sellers_amount screen_size memory_size
3      43.272       39.816        59.736             36        5.00      16.000
4      43.272       39.816        59.736             36        5.00      16.000
11    118.752      111.504       128.928              8        6.21      64.000
15     14.424       12.936        16.872             31        1.77       0.032
20     15.912       11.976        28.056              5        1.80       0.004
24     14.304       13.056        16.776             35        1.80       0.032
26    131.976      108.468       127.176              2        6.21     128.000
32    126.528      119.280       130.752              3        5.45      64.000
33    126.528      119.280       130.752              3        5.45      64.000
35    127.872      108.468       127.176              1        5.95      64.000
   battery_size release_date month year
3          2000       9-2020     9   20
4          2000       9-2020     9   20
11         3400      12-2018    12   18
15          800      11-2019    11   19
20          800       9-2017     9   17
24          800       1-2019     1   19
26         3400       5-2019     5   19
32         3000       5-2018     5   18
33         3000       5-2018     5   18
35         3500       6-2018     6   18</code></pre>
</div>
</div>
<p>We decide to aggregate the duplicates in one row, having its <code>popularity</code> subsituted by the mean of the duplicates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>idxs <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">duplicated</span>(df[,<span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">4</span>)]))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>succ <span class="ot">&lt;-</span> idxs[<span class="sc">-</span><span class="fu">length</span>(idxs)] <span class="sc">-</span> idxs[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>succ <span class="ot">&lt;-</span> <span class="fu">c</span>(succ, <span class="cn">FALSE</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (i <span class="sc">&lt;=</span> <span class="fu">length</span>(idxs)){</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">=</span> idxs[i]<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> <span class="fu">c</span>(df<span class="sc">$</span>popularity[idxs[i]])</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (succ[i] <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    sum <span class="ot">&lt;-</span> <span class="fu">c</span>(sum, df<span class="sc">$</span>popularity[idxs[i]])</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>popularity[start] <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(sum, df<span class="sc">$</span>popularity[start]))</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="sc">-</span>idxs, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="handling-popularity" class="level3">
<h3 class="anchored" data-anchor-id="handling-popularity">Handling popularity</h3>
<p>We decided to group phones by their <code>popularity</code> in a new variable called <code>popularity_level</code> defined as: - Phones below the first <code>popularity</code> quartile are labeled as <strong>low</strong> - Phones above the first <code>popularity</code> quartile and below the second are labeled as <strong>low-medium</strong> - Phones above the second <code>popularity</code> quartile and below the third are labeled as <strong>medium-high</strong> - Phones above the third <code>popularity</code> quartile are labeled as <strong>high</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>popularity <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>popularity)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>tag <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>popularity)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>popularity_levels <span class="ot">&lt;-</span> <span class="fu">cut</span>(df<span class="sc">$</span>popularity, <span class="at">breaks =</span> tag,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="at">labels=</span><span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"medium-low"</span>, <span class="st">"medium-high"</span>, <span class="st">"high"</span>), <span class="at">include.lowest=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="dataset-exploration" class="level2">
<h2 class="anchored" data-anchor-id="dataset-exploration">Dataset exploration</h2>
<section id="correlation-matrix" class="level3">
<h3 class="anchored" data-anchor-id="correlation-matrix">Correlation matrix</h3>
<p>We begin by computing the correlation matrix between the quantitative variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the numeric columns</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df_numeric <span class="ot">&lt;-</span> df[<span class="fu">sapply</span>(df, is.numeric)]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the correlation matrix</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(df_numeric, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(cor_matrix, <span class="at">hc.order =</span> <span class="cn">TRUE</span>, <span class="at">lab =</span> <span class="cn">TRUE</span>, <span class="at">colors=</span><span class="fu">c</span>(<span class="st">"yellow"</span>, <span class="st">"white"</span>, <span class="st">"purple"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this matrix we can deduce: - The features <code>highest_price</code> and <code>lowest_price</code> are pretty much linearly correlated with <code>best_price</code> - <code>memory_size</code> also shows a strong positive correlation with <code>best_price</code> and a mild postive correlation with <code>screen_size</code> - <code>year</code>, <code>popularity</code>, <code>sellers_amount</code> and <code>screen_size</code> show a light positive correlation - <code>month</code> and <code>battery_size</code> show almost no linear correlation with <code>best_price</code></p>
</section>
<section id="barplots" class="level3">
<h3 class="anchored" data-anchor-id="barplots">Barplots</h3>
<p>For the quantitive variables we decided to plot the barplots. Notably we decided to color the bars based on their <code>os</code> feature, since we expect the phones with <code>os == "other"</code> to have a different distribution than Android and iOs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">8</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> cols) {</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">mat=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dv">2</span>,<span class="dv">1</span>,<span class="at">byrow =</span> <span class="cn">TRUE</span>), <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>) )</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">3.1</span>,<span class="fl">1.1</span>,<span class="fl">2.1</span>))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">boxplot</span>(df[, i], <span class="at">horizontal =</span> <span class="cn">TRUE</span>,  <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">col=</span> <span class="st">"yellow"</span>, <span class="at">frame=</span> F, <span class="at">main=</span><span class="fu">colnames</span>(df)[i]) <span class="co"># xaxt</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="fl">3.1</span>,<span class="fl">1.1</span>,<span class="fl">2.1</span>))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(df[, i],<span class="at">border =</span> F, <span class="at">main =</span> <span class="st">""</span>, <span class="at">col=</span><span class="st">"purple"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-24-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-24-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-24-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">mat=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dv">2</span>,<span class="dv">1</span>,<span class="at">byrow =</span> <span class="cn">TRUE</span>), <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>) )</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">3.1</span>,<span class="fl">1.1</span>,<span class="fl">2.1</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">boxplot</span>(df[, <span class="st">"screen_size"</span>], <span class="at">horizontal =</span> <span class="cn">TRUE</span>,  <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">col=</span> <span class="st">"yellow"</span>, <span class="at">frame=</span> F, <span class="at">main=</span><span class="fu">colnames</span>(df)[<span class="st">"screen_size"</span>]) <span class="co"># xaxt</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="fl">3.1</span>,<span class="fl">1.1</span>,<span class="fl">2.1</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(df[, <span class="st">"screen_size"</span>],<span class="at">border =</span> F, <span class="at">main =</span> <span class="st">""</span>, <span class="at">col=</span><span class="st">"purple"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the ggplot2 package</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a stacked barplot of df$screen_size colored by df$os</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(screen_size), <span class="at">fill =</span> os)) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Screen Size by OS"</span>, <span class="at">x =</span> <span class="st">"Screen Size"</span>, <span class="at">y =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a histogram of df$screen_size colored by df$os</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>hist_screen_size <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> screen_size, <span class="at">fill =</span> os)) <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">bins =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Screen Size by OS"</span>, <span class="at">x =</span> <span class="st">"Screen Size"</span>, <span class="at">y =</span> <span class="st">"Count"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a boxplot of df$screen_size colored by df$os</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>box_screen_size <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> os, <span class="at">y =</span> screen_size, <span class="at">fill =</span> os)) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Boxplot of Screen Size by OS"</span>, <span class="at">x =</span> <span class="st">"OS"</span>, <span class="at">y =</span> <span class="st">"Screen Size"</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange the histogram and boxplot in a grid</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(hist_screen_size, box_screen_size, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a histogram of df$memory_size colored by df$os</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>hist_screen_size <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> memory_size, <span class="at">fill =</span> os)) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Memory Size by OS"</span>, <span class="at">x =</span> <span class="st">"Memory Size"</span>, <span class="at">y =</span> <span class="st">"Count"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a boxplot of df$memory_size colored by df$os</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>box_screen_size <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> os, <span class="at">y =</span> memory_size, <span class="at">fill =</span> os)) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Boxplot of Memory Size by OS"</span>, <span class="at">x =</span> <span class="st">"OS"</span>, <span class="at">y =</span> <span class="st">"Memory Size"</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange the histogram and boxplot in a grid</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(hist_screen_size, box_screen_size, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a histogram of df$battery_size colored by df$os</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>hist_screen_size <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> battery_size, <span class="at">fill =</span> os)) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">bins =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Battery Size by OS"</span>, <span class="at">x =</span> <span class="st">"Battery Size"</span>, <span class="at">y =</span> <span class="st">"Count"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a boxplot of df$battery_size colored by df$os</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>box_screen_size <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> os, <span class="at">y =</span> battery_size, <span class="at">fill =</span> os)) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Boxplot of Battery size by OS"</span>, <span class="at">x =</span> <span class="st">"OS"</span>, <span class="at">y =</span> <span class="st">"Battery Size"</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange the histogram and boxplot in a grid</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(hist_screen_size, box_screen_size, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="StatProjectNC_files/figure-html/unnamed-chunk-27-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>